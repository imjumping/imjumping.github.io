<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>123</title>
    <!-- 引入 Roboto 字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #333;
            text-align: center;
            transition: background 1.5s ease;
            min-height: 200vh; /* 确保有足够高度可滚动 */
            overflow-x: hidden;
        }

        strong {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 2rem;
            color: #333;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
            font-family: 'Roboto', sans-serif;
            letter-spacing: -2px;
            transition: color 0.5s ease;
        }

        button {
            font-family: 'Roboto', sans-serif;
            font-size: 2rem;
            padding: 1.3rem 3rem;
            margin: 1rem;
            border: none;
            border-radius: 60px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            min-width: 120px;
        }

        button:nth-child(2) {
            background-color: #FA2336;
            color: white;
        }

        button:nth-child(3) {
            background-color: #4CAF50;
            color: white;
        }

        button:nth-child(4) {
            background-color: #2196F3;
            color: white;
        }

        button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
        }

        button:active {
            transform: translateY(2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .result {
            margin-top: 2.5rem;
            font-size: 2.5rem;
            font-weight: bold;
            min-height: 3.5rem;
            color: #333;
            font-family: 'Roboto', sans-serif;
            animation: fadeIn 0.5s ease-out;
            transition: color 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <strong>请计算1+1</strong>
    <button>2</button>
    <button>3</button>
    <button>4</button>
    <div class="result"></div>

    <script>
        const buttons = document.querySelectorAll('button');
        const resultDisplay = document.querySelector('.result');
        const body = document.body;
        const strongElement = document.querySelector('strong');
        let buttonCount = 4; // 初始按钮数量

        // 颜色数组 - 更丰富的色彩选择
        const colorPalettes = [
            ['#ff9a9e', '#fecfef'],
            ['#a8e6cf', '#dcedc1'],
            ['#ffd3a5', '#ff9e9d'],
            ['#b19cd9', '#9c88ff'],
            ['#ffecd2', '#fcb69f'],
            ['#a0c4ff', '#92bce8'],
            ['#f8c9e5', '#f3b6e0'],
            ['#e0e7ff', '#d3e8ff'],
            ['#ffdfb3', '#ffc6c6'],
            ['#a6e3e9', '#f0f0f0']
        ];

        let currentPaletteIndex = 0;
        let isScrolling = false;
        let lastScrollTop = 0;

        // 初始化背景
        updateBackground();

        // 为现有按钮添加点击事件
        buttons.forEach(button => {
            button.addEventListener('click', () => {
                resultDisplay.textContent = '';
                resultDisplay.style.color = '';

                if (button.textContent === '3') {
                    resultDisplay.textContent = '你答对了！';
                    resultDisplay.style.color = '#4CAF50';
                    button.style.transform = 'scale(1.15)';
                    setTimeout(() => button.style.transform = '', 300);
                } else {
                    resultDisplay.textContent = '你打错了';
                    resultDisplay.style.color = '#f44336';
                    button.style.transform = 'scale(1.15)';
                    setTimeout(() => button.style.transform = '', 300);
                }

                // 点击按钮时改变背景颜色
                changeBackground();
            });
        });

        // 监听空格键点击事件
        document.addEventListener('keydown', (event) => {
            if (event.code === 'Space' || event.key === ' ') {
                event.preventDefault(); // 防止页面滚动

                // 创建新按钮
                const newButton = document.createElement('button');
                newButton.textContent = buttonCount + 1;
                newButton.style.backgroundColor = '#2196F3';
                newButton.style.color = 'white';
                newButton.style.fontSize = '2rem';
                newButton.style.padding = '1.3rem 3rem';
                newButton.style.margin = '1rem';
                newButton.style.border = 'none';
                newButton.style.borderRadius = '60px';
                newButton.style.cursor = 'pointer';
                newButton.style.fontWeight = '700';
                newButton.style.boxShadow = '0 6px 20px rgba(0, 0, 0, 0.15)';
                newButton.style.minWidth = '120px';
                newButton.style.fontFamily = '\'Roboto\', sans-serif';

                newButton.addEventListener('click', () => {
                    resultDisplay.textContent = '';
                    resultDisplay.style.color = '';
                    resultDisplay.textContent = '你打错了';
                    resultDisplay.style.color = '#f44336';
                    newButton.style.transform = 'scale(1.15)';
                    setTimeout(() => newButton.style.transform = '', 300);
                    changeBackground();
                });

                const lastButton = document.querySelector('button:last-child');
                document.body.insertBefore(newButton, resultDisplay);
                buttonCount++;

                changeBackground(); // 空格键也切换背景
            }
        });

        // 自动改变背景颜色（每5秒一次）
        setInterval(changeBackground, 5000);

        // 更新背景函数（使用当前调色板）
        function updateBackground() {
            const currentPalette = colorPalettes[currentPaletteIndex];
            body.style.background = `linear-gradient(135deg, ${currentPalette[0]} 0%, ${currentPalette[1]} 100%)`;

            // 根据背景调整文字颜色
            const bgColor1 = hexToRgb(currentPalette[0]);
            const bgColor2 = hexToRgb(currentPalette[1]);
            const avgBrightness = (getBrightness(bgColor1) + getBrightness(bgColor2)) / 2;

            if (avgBrightness > 180) {
                strongElement.style.color = '#333';
                resultDisplay.style.color = '#333';
            } else {
                strongElement.style.color = '#fff';
                resultDisplay.style.color = '#fff';
            }
        }

        // 改变背景颜色（跳转到下一个调色板）
        function changeBackground() {
            currentPaletteIndex = (currentPaletteIndex + 1) % colorPalettes.length;
            updateBackground();
        }

        // 将十六进制颜色转换为RGB
        function hexToRgb(hex) {
            hex = hex.replace('#', '');
            if (hex.length === 3) {
                hex = hex.split('').map(char => char + char).join('');
            }
            const bigint = parseInt(hex, 16);
            return {
                r: (bigint >> 16) & 255,
                g: (bigint >> 8) & 255,
                b: bigint & 255
            };
        }

        // 计算颜色的亮度
        function getBrightness(color) {
            return (color.r * 299 + color.g * 587 + color.b * 114) / 1000;
        }

        // ================== 新增：滚动时动态改变背景颜色 ==================
        // 线性插值颜色
        function interpolateColor(color1, color2, factor) {
            const r = Math.round(color1.r + (color2.r - color1.r) * factor);
            const g = Math.round(color1.g + (color2.g - color1.g) * factor);
            const b = Math.round(color1.b + (color2.b - color1.b) * factor);
            return `rgb(${r}, ${g}, ${b})`;
        }

        // 滚动时动态更新背景
        function updateBackgroundOnScroll() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const scrollHeight = document.documentElement.scrollHeight - window.innerHeight;
            const scrollProgress = Math.min(Math.max(scrollTop / scrollHeight, 0), 1); // 0~1

            // 获取当前和下一个调色板
            const currentPalette = colorPalettes[currentPaletteIndex];
            const nextPaletteIndex = (currentPaletteIndex + 1) % colorPalettes.length;
            const nextPalette = colorPalettes[nextPaletteIndex];

            // 对每个颜色通道进行插值
            const startTop = hexToRgb(currentPalette[0]);
            const startBottom = hexToRgb(currentPalette[1]);
            const endTop = hexToRgb(nextPalette[0]);
            const endBottom = hexToRgb(nextPalette[1]);

            const topColor = interpolateColor(startTop, endTop, scrollProgress);
            const bottomColor = interpolateColor(startBottom, endBottom, scrollProgress);

            // 设置渐变背景
            body.style.background = `linear-gradient(135deg, ${topColor} 0%, ${bottomColor} 100%)`;

            // 根据插值后的平均亮度调整文字颜色
            const avgTop = getBrightness(hexToRgb(topColor));
            const avgBottom = getBrightness(hexToRgb(bottomColor));
            const avgBrightness = (avgTop + avgBottom) / 2;

            if (avgBrightness > 180) {
                strongElement.style.color = '#333';
                resultDisplay.style.color = '#333';
            } else {
                strongElement.style.color = '#fff';
                resultDisplay.style.color = '#fff';
            }
        }

        // 滚动节流函数（优化性能）
        function throttle(func, limit) {
            let inThrottle;
            return function (...args) {
                if (!inThrottle) {
                    func.apply(this, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }

        // 监听滚动事件（节流优化，约60fps）
        window.addEventListener('scroll', throttle(updateBackgroundOnScroll, 16));
    </script>
</body>
</html>